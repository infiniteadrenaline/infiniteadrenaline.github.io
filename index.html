<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Infinite Adrenaline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --cyan: #00e6ff;
        --red: #ff2e2b;
        --muted: rgba(255, 255, 255, 0.16);
      }
      html,
      body {
        height: 100%;
      }
      body {
        background: #000;
        color: #fff;
        font-family: "Space Mono", monospace;
        overflow-x: hidden;
        position: relative;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="2" height="2"><rect width="1" height="1" fill="rgba(0,230,255,0.002)"/><rect x="1" y="1" width="1" height="1" fill="rgba(0,230,255,0.002)"/></svg>');
      }
      .orbitron {
        font-family: "Orbitron", sans-serif;
      }

      .terminal-text {
        text-shadow: 0 0 1px rgba(0, 230, 255, 0.4),
          0 0 2px rgba(0, 230, 255, 0.3), 0 0 4px rgba(0, 230, 255, 0.2);
        opacity: 0.88;
        animation: terminal-flicker 1.5s infinite;
      }
      @keyframes terminal-flicker {
        0%,
        19%,
        21%,
        23%,
        25%,
        54%,
        56%,
        100% {
          opacity: 0.88;
        }
        20%,
        22%,
        24%,
        55% {
          opacity: 0.65;
        }
      }

      .bg-scanlines {
        background-image: repeating-linear-gradient(
          0deg,
          rgba(0, 230, 255, 0.02),
          rgba(0, 230, 255, 0.02) 1px,
          transparent 1px,
          transparent 2px
        );
      }
      .bg-radial {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
      }
      .radial-1 {
        background: radial-gradient(
          circle at 30% 30%,
          rgba(0, 230, 255, 0.03) 0%,
          transparent 70%
        );
        animation: pulse-1 15s infinite alternate;
      }
      .radial-2 {
        background: radial-gradient(
          circle at 70% 70%,
          rgba(0, 230, 255, 0.02) 0%,
          transparent 70%
        );
        animation: pulse-2 20s infinite alternate;
      }
      .scanline {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          to bottom,
          transparent 0%,
          rgba(0, 230, 255, 0.01) 50%,
          transparent 100%
        );
        animation: scan 8s linear infinite;
        pointer-events: none;
        z-index: -1;
      }
      @keyframes pulse-1 {
        0% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }
      @keyframes pulse-2 {
        0% {
          opacity: 0.3;
          transform: scale(1);
        }
        100% {
          opacity: 0.5;
          transform: scale(1.05);
        }
      }
      @keyframes scan {
        0% {
          transform: translateY(-100%);
        }
        100% {
          transform: translateY(100%);
        }
      }

      .center-inactive {
        opacity: 0 !important;
        pointer-events: none !important;
        user-select: none !important;
        transition: opacity 0.7s cubic-bezier(0.2, 0.9, 0.2, 1);
      }
      .center-active {
        opacity: 1 !important;
        pointer-events: auto !important;
        transition: opacity 0.7s cubic-bezier(0.2, 0.9, 0.2, 1);
      }

      @keyframes rotate-3d {
        from {
          transform: rotateY(0);
        }
        to {
          transform: rotateY(360deg);
        }
      }
      .png-rotate-3d {
        transform-style: preserve-3d;
        animation: rotate-3d 8s linear infinite;
      }

      /* Desktop icons */
      .desktop-icons {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        top: 34%;
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        justify-content: center;
        align-items: center;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.45s ease;
        z-index: 5;
      }
      .desktop-icon {
        width: 92px;
        height: 92px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.35rem;
        cursor: pointer;
        user-select: none;
        transform: translateY(0);
        opacity: 0;
        transition: transform 0.18s ease, filter 0.18s ease, opacity 0.25s ease;
        filter: contrast(1.12) saturate(1.05);
      }
      .desktop-icon svg {
        width: 64px;
        height: 64px;
        display: block;
        fill: none;
        stroke: var(--cyan);
        stroke-width: 1.6;
        stroke-linecap: round;
        stroke-linejoin: round;
        filter: drop-shadow(0 0 10px rgba(0, 230, 255, 0.14))
          drop-shadow(0 0 22px rgba(0, 230, 255, 0.08));
        animation: terminal-flicker 1.5s infinite;
        transition: transform 0.16s ease, filter 0.16s ease;
      }
      .desktop-icon .icon-fill {
        fill: var(--cyan);
        opacity: 0.22;
        transition: opacity 0.15s ease;
      }
      .desktop-icon .icon-fill-strong {
        fill: var(--cyan);
        opacity: 0.38;
        transition: opacity 0.15s ease;
      }
      .desktop-icon .icon-label {
        color: var(--cyan);
        font-family: "Orbitron", sans-serif;
        font-size: 12px;
        letter-spacing: 0.06em;
        opacity: 0;
        transform: translateY(6px);
        transition: opacity 0.18s ease,
          transform 0.18s cubic-bezier(0.2, 0.9, 0.2, 1);
        pointer-events: none;
      }
      .desktop-icon:hover .icon-label {
        opacity: 1;
        transform: translateY(0);
      }
      .desktop-icon:hover svg {
        transform: translateY(-6px) scale(1.04);
        filter: drop-shadow(0 0 14px rgba(0, 230, 255, 0.22))
          drop-shadow(0 0 32px rgba(0, 230, 255, 0.12));
      }

      @media (max-width: 640px) {
        .desktop-icon svg {
          width: 52px;
          height: 52px;
        }
        .desktop-icons {
          top: 36%;
          gap: 1rem;
        }
      }

      /* ========== WINDOWS (base styles you designed) ========== */
      .windows-root {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 10;
      }

      .app-window {
        position: absolute;
        width: 640px;
        height: 420px;
        min-width: 280px;
        min-height: 160px;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.65),
          rgba(0, 0, 0, 0.55)
        );
        border: 1px solid rgba(0, 230, 255, 0.12);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6),
          0 0 20px rgba(0, 230, 255, 0.06) inset;
        border-radius: 10px;
        backdrop-filter: blur(6px) saturate(120%);
        overflow: hidden;
        pointer-events: auto;
        transform-origin: center center;
        will-change: transform, opacity, left, top, width, height;
        transform: translateY(8px) scale(0.98);
        opacity: 0;
        transition:
          transform 360ms cubic-bezier(0.2, 0.9, 0.2, 1),
          opacity 260ms ease,
          left 360ms cubic-bezier(0.2, 0.9, 0.2, 1),
          top 360ms cubic-bezier(0.2, 0.9, 0.2, 1),
          width 360ms cubic-bezier(0.2, 0.9, 0.2, 1),
          height 360ms cubic-bezier(0.2, 0.9, 0.2, 1);
        z-index: 20;
      }
      .app-window.open {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      .app-window.sci-fade {
        border: 1px solid rgba(0, 230, 255, 0.16);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6),
          0 0 28px rgba(0, 230, 255, 0.06) inset,
          0 0 40px rgba(0, 230, 255, 0.06);
      }

      .app-window .win-header {
        height: 36px;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 0 12px;
        user-select: none;
        cursor: grab;
        background: linear-gradient(
          90deg,
          rgba(0, 230, 255, 0.02),
          transparent
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.02);
      }
      .app-window .win-title {
        flex: 1;
        font-family: "Orbitron", sans-serif;
        font-size: 13px;
        letter-spacing: 0.08em;
        color: var(--cyan);
      }
      .win-controls {
        display: flex;
        gap: 8px;
      }
      .win-btn {
        width: 14px;
        height: 14px;
        aspect-ratio: 1;
        display: inline-grid;
        place-items: center;
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.03);
        cursor: pointer;
      }
      .win-btn:hover {
        transform: translateY(-2px);
      }
      .win-btn.min {
        color: rgba(0, 230, 255, 0.85);
      }
      .win-btn.max {
        color: rgba(0, 230, 255, 0.9);
      }
      .win-btn.close {
        color: rgba(255, 80, 80, 0.9);
      }

      .app-window .win-content {
        padding: 12px;
        height: calc(100% - 36px);
        overflow: auto;
        font-size: 13px;
        color: rgba(200, 255, 255, 0.92);
      }
      .win-resize-handle {
        position: absolute;
        width: 14px;
        height: 14px;
        right: 6px;
        bottom: 6px;
        cursor: nwse-resize;
        opacity: 0.7;
      }

      /* Dock (bottom-center) */
      .window-dock {
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        bottom: 12px;
        display: flex;
        gap: 10px;
        z-index: 80;
        pointer-events: auto;
        transition: bottom 180ms ease, transform 160ms ease;
        padding: 8px 12px;
        border-radius: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border: 1px solid rgba(0, 230, 255, 0.04);
        backdrop-filter: blur(6px) saturate(120%);
      }
      .dock-item {
        min-width: 48px;
        height: 44px;
        padding: 6px 10px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        border-radius: 10px;
        background: transparent;
        color: var(--cyan);
        font-family: "Orbitron", sans-serif;
        font-size: 12px;
        cursor: pointer;
        user-select: none;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.6);
        transition: transform 160ms cubic-bezier(0.2, 0.9, 0.2, 1),
          background 160ms ease, box-shadow 160ms ease, opacity 160ms ease;
        will-change: transform, opacity;
      }
      .dock-item.active {
        background: linear-gradient(
          180deg,
          rgba(0, 230, 255, 0.06),
          rgba(0, 230, 255, 0.03)
        );
        box-shadow: 0 10px 30px rgba(0, 230, 255, 0.06);
      }
      .dock-item::after {
        content: "";
        display: block;
        height: 3px;
        width: 18px;
        border-radius: 3px;
        background: transparent;
        margin-top: 6px;
        opacity: 0;
        transition: opacity 160ms ease, transform 160ms ease;
        transform-origin: center;
      }
      .dock-item.active::after {
        background: var(--cyan);
        opacity: 1;
        transform: translateY(0);
      }
      .dock-item:hover {
        transform: translateY(-6px) scale(1.06);
        background: rgba(255, 255, 255, 0.02);
      }
      .dock-item.minimized {
        opacity: 0.72;
      }
      @media (max-width: 640px) {
        .window-dock {
          gap: 6px;
          padding: 6px 8px;
          bottom: 8px;
        }
        .dock-item {
          min-width: 40px;
          height: 36px;
          font-size: 11px;
        }
        .dock-item::after {
          width: 14px;
          height: 2.5px;
        }
      }

      .app-window.maximized {
        width: calc(100vw - 80px);
        height: calc(100vh - 96px);
        left: 40px !important;
        top: 40px !important;
        border-radius: 12px;
      }
      .app-window.top {
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6),
          0 0 46px rgba(0, 230, 255, 0.06);
        transform: translateY(0) scale(1.01);
      }
      .win-header:active {
        cursor: grabbing;
      }

      .placeholder-empty {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(0, 230, 255, 0.12);
        font-size: 14px;
        letter-spacing: 0.06em;
      }
      .app-window.closing {
        transform: translateY(8px) scale(0.96);
        opacity: 0;
        transition: transform 220ms ease, opacity 180ms ease;
      }

      /* System tray / clock (clock remains bottom-right) */
      .sys-tray {
        position: fixed;
        right: 12px;
        bottom: 12px;
        z-index: 120;
        display: flex;
        gap: 8px;
        align-items: flex-end;
        pointer-events: auto;
      }

      .clock-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 10px;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.45),
          rgba(0, 0, 0, 0.2)
        );
        border: 1px solid rgba(0, 230, 255, 0.06);
        color: var(--cyan);
        font-family: "Orbitron", sans-serif;
        font-size: 12px;
        cursor: pointer;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
        transition: transform 160ms ease, background 160ms ease;
        backdrop-filter: blur(6px) saturate(120%);
      }
      .clock-btn:hover {
        transform: translateY(-4px);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.16)
        );
      }
      .clock-time {
        font-weight: 700;
        letter-spacing: 0.02em;
      }
      .clock-date {
        font-size: 10px;
        opacity: 0.9;
      }

      /* Calendar panel now re-skinned to be an app-window-like floating window anchored bottom-right */
      .calendar-panel {
        position: fixed;
        right: 12px;
        bottom: 64px;
        width: 320px;
        max-width: calc(100vw - 40px);
        border-radius: 10px;
        padding: 0; /* inner padding handled by win-content */
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.65),
          rgba(0, 0, 0, 0.55)
        );
        border: 1px solid rgba(0, 230, 255, 0.12);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6),
          0 0 20px rgba(0, 230, 255, 0.06) inset;
        color: rgba(200, 255, 255, 0.95);
        transform-origin: bottom right;
        transform: translateY(8px) scale(0.98);
        opacity: 0;
        pointer-events: none;
        transition: opacity 180ms ease,
          transform 180ms cubic-bezier(0.2, 0.9, 0.2, 1);
        z-index: 130;
        backdrop-filter: blur(8px) saturate(120%);
      }
      .calendar-panel.open {
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: auto;
      }

      /* inside header and content uses the same classes as .app-window for consistency */
      .calendar-panel .win-header {
        height: 36px;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 0 12px;
        cursor: grab;
        border-bottom: 1px solid rgba(255, 255, 255, 0.02);
        background: linear-gradient(
          90deg,
          rgba(0, 230, 255, 0.02),
          transparent
        );
      }
      .calendar-panel .win-title {
        color: var(--cyan);
        font-family: "Orbitron", sans-serif;
        font-size: 13px;
        letter-spacing: 0.08em;
        flex: 1;
      }
      .calendar-panel .win-content {
        padding: 12px;
        height: auto;
        max-height: 60vh;
        overflow: auto;
        font-size: 13px;
        color: rgba(200, 255, 255, 0.92);
      }

      .cal-title {
        font-family: "Orbitron", sans-serif;
        font-size: 14px;
        letter-spacing: 0.06em;
        color: var(--cyan);
      }
      .cal-controls button {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.03);
        padding: 6px 8px;
        border-radius: 8px;
        color: rgba(200, 255, 255, 0.92);
        cursor: pointer;
      }

      .cal-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
        font-size: 11px;
        opacity: 0.8;
        margin-bottom: 6px;
        text-align: center;
      }
      .cal-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
      }
      .cal-cell {
        min-height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        font-size: 13px;
        color: rgba(200, 255, 255, 0.86);
      }
      .cal-cell.other {
        color: rgba(200, 255, 255, 0.28);
      }
      .cal-cell.today {
        background: linear-gradient(
          180deg,
          rgba(0, 230, 255, 0.12),
          rgba(0, 230, 255, 0.06)
        );
        border: 1px solid rgba(0, 230, 255, 0.14);
        color: var(--cyan);
        font-weight: 700;
        box-shadow: 0 8px 20px rgba(0, 230, 255, 0.03) inset;
      }

      .cal-footer {
        margin-top: 10px;
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
      }

      .notif-list {
        margin-top: 8px;
        font-size: 12px;
        color: rgba(200, 255, 255, 0.84);
        opacity: 0.95;
        max-height: 92px;
        overflow: auto;
      }

      @media (max-width: 420px) {
        .calendar-panel {
          width: 92vw;
          right: 4vw;
          bottom: 68px;
        }
        .window-dock {
          bottom: 8px;
        }
      }
    </style>
  </head>

  <body class="bg-scanlines flex items-center justify-center">
    <div class="bg-radial radial-1"></div>
    <div class="bg-radial radial-2"></div>
    <div class="scanline"></div>

    <div
      class="container mx-auto px-4 py-8 flex flex-col items-center justify-center text-center"
    >
      <div class="mb-8 png-rotate-3d">
        <img
          src="https://raw.githubusercontent.com/Smg-v1/Smg-v1.github.io/refs/heads/main/c.png"
          alt="Infinite Adrenaline Core"
          width="120"
          height="120"
          class="mx-auto select-none"
          draggable="false"
          style="filter: drop-shadow(0 0 8px rgba(0, 230, 255, 0.3))"
        />
      </div>

      <h1
        class="orbitron text-3xl md:text-4xl uppercase tracking-widest mb-2 text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-cyan-600 drop-shadow-[0_0_5px_rgba(0,230,255,0.5)]"
      >
        INFINITE ADRENALINE
      </h1>
      <p
        class="text-xs text-cyan-300/70 mb-8 drop-shadow-[0_0_2px_rgba(0,230,255,0.3)]"
      >
        -
      </p>
    </div>

    <!-- DESKTOP ICONS -->
    <div class="desktop-icons" id="desktop-icons">
      <!-- Files -->
      <div
        class="desktop-icon"
        data-action="open-files"
        title="Files"
        role="button"
        tabindex="0"
      >
        <svg viewBox="0 0 64 64" aria-hidden="true" role="img">
          <path
            class="icon-fill"
            d="M8 20c0-1.6 1.2-3 2.8-3h16l4-6h20c1.8 0 3.2 1.4 3.2 3.2v26.8c0 1.8-1.4 3.2-3.2 3.2H10.8C9 44.2 8 42.8 8 41.2V20z"
          />
          <path class="icon-fill-strong" d="M26 14h18l6 6H30z" />
          <path
            d="M8 20h16l4-6h20c1.8 0 3.2 1.4 3.2 3.2v26.8c0 1.8-1.4 3.2-3.2 3.2H10.8C9 44.2 8 42.8 8 41.2V20z"
          />
          <rect x="18" y="30" width="28" height="2" fill="rgba(0,0,0,0.12)" />
          <path
            stroke="rgba(255,255,255,0.10)"
            stroke-width=".6"
            d="M12 22 L28 16"
          />
        </svg>
        <div class="icon-label">Files</div>
      </div>

      <!-- Updates -->
      <div
        class="desktop-icon"
        data-action="open-updates"
        title="Updates"
        role="button"
        tabindex="0"
      >
        <svg viewBox="0 0 64 64" aria-hidden="true" role="img">
          <path
            class="icon-fill"
            d="M14 12h28l8 8v28c0 1.6-1.2 2.8-2.8 2.8H14c-1.8 0-3.2-1.4-3.2-3.2V14.8C10.8 13 12.2 12 14 12z"
          />
          <path class="icon-fill-strong" d="M42 12v8h8" />
          <path
            d="M14 12h28l8 8v28c0 1.6-1.2 2.8-2.8 2.8H14c-1.8 0-3.2-1.4-3.2-3.2V14.8C10.8 13 12.2 12 14 12z"
          />
          <rect
            x="20"
            y="28"
            width="24"
            height="3"
            rx="1"
            fill="rgba(255,255,255,0.06)"
          />
          <rect
            x="20"
            y="34"
            width="20"
            height="3"
            rx="1"
            fill="rgba(255,255,255,0.04)"
          />
          <rect
            x="20"
            y="40"
            width="16"
            height="3"
            rx="1"
            fill="rgba(255,255,255,0.03)"
          />
          <g transform="translate(46,20)">
            <circle cx="0" cy="0" r="6" class="icon-fill-strong" />
            <path
              d="M-2 -1 A6 6 0 0 1 6 3"
              stroke="var(--cyan)"
              stroke-width="1.4"
              fill="none"
              stroke-linecap="round"
              stroke-linejoin="round"
              transform="translate(-1,0)"
            />
            <path
              d="M5 3 L7 1 L5 -1"
              stroke="var(--cyan)"
              stroke-width="1.4"
              fill="none"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </g>
          <path
            stroke="rgba(255,255,255,0.10)"
            stroke-width=".6"
            d="M18 16 L42 16"
          />
        </svg>
        <div class="icon-label">Updates</div>
      </div>

      <!-- Community -->
      <div
        class="desktop-icon"
        data-action="open-community"
        title="Community"
        role="button"
        tabindex="0"
      >
        <svg viewBox="0 0 64 64" aria-hidden="true" role="img">
          <circle class="icon-fill-strong" cx="20" cy="20" r="5" />
          <circle class="icon-fill-strong" cx="44" cy="20" r="5" />
          <circle class="icon-fill-strong" cx="32" cy="36" r="5" />
          <path
            stroke="var(--cyan)"
            stroke-width="1.8"
            stroke-linecap="round"
            d="M20 20 L32 36 L44 20 M20 20 L44 20"
          />
        </svg>
        <div class="icon-label">Community</div>
      </div>

      <!-- About -->
      <div
        class="desktop-icon"
        data-action="open-about"
        title="About"
        role="button"
        tabindex="0"
      >
        <svg viewBox="0 0 64 64" aria-hidden="true" role="img">
          <circle class="icon-fill" cx="32" cy="28" r="14" />
          <circle
            cx="32"
            cy="28"
            r="14"
            stroke="var(--cyan)"
            stroke-width="1.4"
            fill="none"
          />
          <rect
            x="30"
            y="22"
            width="4"
            height="4"
            rx="1.2"
            fill="var(--cyan)"
          />
          <rect
            x="30"
            y="28"
            width="4"
            height="10"
            rx="1.6"
            fill="var(--cyan)"
          />
        </svg>
        <div class="icon-label">About</div>
      </div>
    </div>

    <!-- windows root and dock -->
    <div class="windows-root" id="windows-root" aria-hidden="false"></div>
    <div class="window-dock" id="window-dock" aria-hidden="false"></div>

    <!-- SYSTEM TRAY + CALENDAR (now window-styled) -->
    <div class="sys-tray" id="sys-tray" aria-hidden="false">
      <!-- Calendar panel is now styled as an app-window (header + content) to match your windows -->
      <div
        id="calendar-panel"
        class="calendar-panel sci-fade"
        aria-hidden="true"
        role="dialog"
        aria-label="Calendar"
      >
        <div class="win-header" role="toolbar" aria-label="Calendar header">
          <div class="win-title">Calendar</div>
          <div class="win-controls" role="group" aria-label="calendar controls">
            <div class="win-btn close" title="Close" id="cal-close">×</div>
          </div>
        </div>

        <div class="win-content">
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              margin-bottom: 8px;
            "
          >
            <div id="cal-title" class="cal-title">Month Year</div>
            <div class="cal-controls">
              <button id="cal-prev" title="Previous month">‹</button>
              <button id="cal-next" title="Next month">›</button>
            </div>
          </div>

          <div class="cal-weekdays" aria-hidden="false">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
          </div>

          <div
            class="cal-grid"
            id="cal-grid"
            role="grid"
            aria-live="polite"
          ></div>

          <div class="cal-footer">
            <div class="cal-now" id="cal-now">Today</div>
            <div class="cal-actions">
              <button id="cal-goto-today" title="Go to today">Today</button>
            </div>
          </div>

          <div style="height: 8px"></div>
          <div
            style="
              opacity: 0.9;
              font-size: 12px;
              color: rgba(200, 255, 255, 0.85);
            "
          >
            Notifications
          </div>
          <div class="notif-list" id="notif-list">
            <div style="opacity: 0.6">No notifications</div>
          </div>
        </div>
      </div>

      <div
        id="clock-btn"
        class="clock-btn"
        role="button"
        aria-haspopup="true"
        aria-expanded="false"
        title="Open calendar"
      >
        <div
          style="
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            min-width: 70px;
          "
        >
          <div class="clock-time" id="clock-time">00:00</div>
          <div class="clock-date" id="clock-date">Jan 1, 1970</div>
        </div>
      </div>
    </div>

    <!-- terminal -->
    <div
      class="fixed bottom-4 left-4 w-[32rem] overflow-hidden flex flex-col bg-transparent"
      style="max-height: calc(100vh - 2rem)"
    >
      <div
        class="px-3 py-1 text-xs text-cyan-300 flex justify-between items-center bg-transparent terminal-text"
      >
        <span>SYSTEM TERMINAL</span>
        <span class="text-cyan-400 text-xs terminal-text">v1.0.3</span>
      </div>
      <div
        id="terminal-output"
        class="overflow-hidden p-2 text-xs text-cyan-300 font-mono bg-transparent text-left terminal-text"
      ></div>
      <div
        class="flex items-center px-2 py-1 bg-transparent border-t border-cyan-300/10"
      >
        <span class="cursor-blink text-cyan-400 mr-1 terminal-text">>_</span>
        <input
          id="terminal-input"
          type="text"
          class="flex-1 bg-transparent text-cyan-300 text-xs font-mono placeholder-cyan-300/30 border-0 focus:outline-none focus:ring-0 whitespace-pre terminal-text"
          autocomplete="off"
          spellcheck="false"
          placeholder="type help for commands"
        />
      </div>
    </div>

    <!-- existing boot / terminal scripts (kept intact) -->
    <script>
      // Center reveal (unchanged)
      (function () {
        const logoContainer = document.querySelector(".container > .mb-8");
        const titleEl = document.querySelector(".container h1.orbitron");
        const subtitleEl = document.querySelector(".container > p");
        [logoContainer, titleEl, subtitleEl].forEach((el) => {
          if (el) {
            el.classList.add("center-inactive");
            el.setAttribute("aria-hidden", "true");
          }
        });
        window.revealCenterSequence = function (cfg = {}) {
          const initialDelay = cfg.initialDelay ?? 1800;
          const logoDelay = cfg.logoDelay ?? 700;
          const titleDelay = cfg.titleDelay ?? 400;
          if (logoContainer.classList.contains("center-active")) return;
          setTimeout(() => {
            logoContainer.classList.remove("center-inactive");
            logoContainer.classList.add("center-active");
            logoContainer.removeAttribute("aria-hidden");
            setTimeout(() => {
              titleEl.classList.remove("center-inactive");
              titleEl.classList.add("center-active");
              titleEl.removeAttribute("aria-hidden");
              setTimeout(() => {
                subtitleEl.classList.remove("center-inactive");
                subtitleEl.classList.add("center-active");
                subtitleEl.removeAttribute("aria-hidden");
              }, titleDelay);
            }, logoDelay);
          }, initialDelay);
        };
        window.addEventListener("load", () => window.revealCenterSequence());
      })();

      // Terminal boot/auth (unchanged logic)
      const terminalInput = document.getElementById("terminal-input");
      const terminalOutput = document.getElementById("terminal-output");

      const bootLines = [
        "> INITIALIZING TERMINAL INTERFACE...",
        "> CHECKING HARDWARE INTERFACES... OK",
        "> MOUNTING FILESYSTEMS... OK",
        "> LOADING SECURITY MODULES... OK",
        "> CHECKING WEBSITE SAFETY... OK",
        "> SCANNING FOR MALICIOUS SCRIPTS... OK",
        "> INITIALIZING NETWORK STACK... OK",
        "> SYSTEM READY",
      ];

      function typeLine(line, callback, delay = 1800) {
        const el = document.createElement("div");
        el.className = "mb-1 whitespace-pre text-left terminal-text";
        terminalOutput.appendChild(el);
        let i = 0;
        const speed = Math.random() * 30 + 20;
        const interval = setInterval(() => {
          if (i < line.length) {
            el.textContent += line.charAt(i);
            i++;
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
          } else {
            clearInterval(interval);
            setTimeout(callback, delay);
          }
        }, speed);
      }

      function runBootSequence() {
        terminalInput.disabled = true;
        let idx = 0;
        function next() {
          if (idx >= bootLines.length) {
            terminalInput.disabled = false;
            terminalInput.focus();
            promptUsername();
            return;
          }
          typeLine(bootLines[idx], () => {
            if (bootLines[idx].includes("INITIALIZING TERMINAL INTERFACE"))
              setTimeout(() => window.revealCenterSequence(), 700);
            idx++;
            next();
          });
        }
        next();
      }

      const correctUsername = "INFINITE",
        correctPassword = "ADRENALINE";
      let stage = "username",
        usernameInput = "";

      function promptUsername() {
        addTerminalOutput("> ENTER USERNAME:");
        stage = "username";
      }
      function promptPassword() {
        addTerminalOutput("> ENTER PASSWORD:");
        stage = "password";
      }

      function addTerminalOutput(msg) {
        const lines = Array.isArray(msg) ? msg : [msg];
        let c = 0;
        function nextLine() {
          if (c >= lines.length) return;
          const el = document.createElement("div");
          el.className = "mb-1 whitespace-pre text-left terminal-text";
          terminalOutput.appendChild(el);
          let i = 0;
          const speed = Math.random() * 30 + 20;
          const interval = setInterval(() => {
            if (i < lines[c].length) {
              el.textContent += lines[c].charAt(i);
              i++;
              terminalOutput.scrollTop = terminalOutput.scrollHeight;
            } else {
              clearInterval(interval);
              c++;
              setTimeout(nextLine, 100);
            }
          }, speed);
        }
        nextLine();
      }

      function maskString(len) {
        return "•".repeat(Math.max(1, len));
      }

      terminalInput.addEventListener("keydown", (e) => {
        if (e.key !== "Enter") return;
        const raw = terminalInput.value;
        terminalInput.value = "";
        const val = raw.trim().toUpperCase();

        if (stage === "username") {
          if (val) addTerminalOutput(`> ${val}`);
          usernameInput = val;
          promptPassword();
          return;
        }

        if (stage === "password") {
          if (raw.length > 0) addTerminalOutput(`> ${maskString(raw.length)}`);
          else addTerminalOutput(`> ${maskString(0)}`);
          const passInput = val;
          if (
            usernameInput === correctUsername &&
            passInput === correctPassword
          ) {
            addTerminalOutput("> ACCESS GRANTED");
            stage = "system";
            setTimeout(() => {
              hideCenter();
              addTerminalOutput(`> WELCOME, ${correctUsername}`);
              setTimeout(() => {
                revealDesktopIcons();
                addTerminalOutput([
                  "> SYSTEM MODE ACTIVE",
                  "> TYPE 'HELP' FOR COMMANDS",
                ]);
              }, 1000);
            }, 1200);
          } else {
            addTerminalOutput("> ACCESS DENIED: INVALID CREDENTIALS");
            setTimeout(promptUsername, 1200);
          }
          return;
        }

        if (stage === "system") {
          handleSystemCommand(raw.trim());
          return;
        }
      });

      function handleSystemCommand(input) {
        if (!input) {
          addTerminalOutput("> ");
          return;
        }
        const parts = input.trim().split(/\s+/);
        const cmd = parts[0].toLowerCase();
        const args = parts.slice(1);

        switch (cmd) {
          case "help":
            addTerminalOutput([
              "> AVAILABLE COMMANDS:",
              "  help      - show this list",
              "  list      - list available desktop sections",
              "  open <x>  - simulate opening a section (files, updates, community, about)",
              "  clear     - clear the terminal output",
            ]);
            break;
          case "list":
            addTerminalOutput("> SECTIONS: files, updates, community, about");
            break;
          case "open":
            if (!args.length) {
              addTerminalOutput("> usage: open <section>");
            } else {
              const target = args[0].toLowerCase();
              addTerminalOutput(`> OPENING: ${target.toUpperCase()}`);
            }
            break;
          case "clear":
            terminalOutput.innerHTML = "";
            break;
          default:
            addTerminalOutput(`> UNKNOWN COMMAND: ${input}`);
        }
      }

      function hideCenter() {
        const logoContainer = document.querySelector(".container > .mb-8");
        const titleEl = document.querySelector(".container h1.orbitron");
        const subtitleEl = document.querySelector(".container > p");
        [logoContainer, titleEl, subtitleEl].forEach((el) => {
          if (el) {
            el.classList.remove("center-active");
            el.classList.add("center-inactive");
            el.setAttribute("aria-hidden", "true");
          }
        });
      }

      function revealDesktopIcons() {
        const icons = document.querySelectorAll(".desktop-icons .desktop-icon");
        const container = document.querySelector(".desktop-icons");
        container.style.opacity = 1;
        container.style.pointerEvents = "auto";
        icons.forEach((icon, idx) => {
          icon.style.opacity = 0;
          icon.style.transform = "translateY(8px)";
          icon.style.transition =
            "opacity 0.45s ease, transform 0.45s cubic-bezier(.2,.9,.2,1)";
          setTimeout(() => {
            icon.style.opacity = 1;
            icon.style.transform = "translateY(0)";
          }, idx * 260);
        });
        setTimeout(() => {
          const first = document.querySelector('.desktop-icon[role="button"]');
          if (first) first.setAttribute("tabindex", "0");
        }, icons.length * 260 + 200);
      }

      document
        .getElementById("desktop-icons")
        .addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            const t = e.target;
            if (t && t.classList && t.classList.contains("desktop-icon"))
              t.click();
          }
        });

      document.querySelectorAll(".desktop-icon").forEach((icon) => {
        icon.addEventListener("click", () => {
          const action = icon.dataset.action;
          addTerminalOutput(`> OPENING: ${action?.toUpperCase() ?? "UNKNOWN"}`);
        });
      });

      runBootSequence();
    </script>

    <!-- window system (kept intact; dock pinned bottom-center) -->
    <script>
      (function () {
        const windowsRoot = document.getElementById("windows-root");
        const dock = document.getElementById("window-dock");
        let zCounter = 30;
        const activeWindows = {};
        const sectionNames = {
          files: "Files",
          updates: "Updates",
          community: "Community",
          about: "About",
        };
        function defaultPos() {
          return {
            left: Math.max(24, window.innerWidth / 2 - 320),
            top: Math.max(24, window.innerHeight / 2 - 210),
          };
        }

        function openWindow(section) {
          section = (section || "").toLowerCase();
          if (!sectionNames[section]) {
            addTerminalOutput(`> ERROR: Unknown section "${section}"`);
            return;
          }
          if (activeWindows[section]) {
            const win = activeWindows[section];
            if (win.dataset.minimized === "true") restoreFromDock(section);
            else bringToFront(win);
            setDockActive(section);
            return;
          }
          const win = document.createElement("div");
          win.className = "app-window sci-fade";
          win.dataset.window = section;
          const pos = defaultPos();
          win.style.left = pos.left + Math.random() * 40 - 20 + "px";
          win.style.top = pos.top + Math.random() * 40 - 20 + "px";
          win.innerHTML = `
            <div class="win-header" role="toolbar" aria-label="${sectionNames[section]} header">
              <div class="win-title">${sectionNames[section]}</div>
              <div class="win-controls" role="group" aria-label="window controls">
                <div class="win-btn min" title="Minimize" data-action="minimize">-</div>
                <div class="win-btn max" title="Maximize" data-action="maximize">□</div>
                <div class="win-btn close" title="Close" data-action="close">×</div>
              </div>
            </div>
            <div class="win-content" tabindex="0">
              <div class="placeholder-empty"> ${sectionNames[section]} — content area (placeholder)</div>
            </div>
            <div class="win-resize-handle" aria-hidden="true"></div>
          `;
          windowsRoot.appendChild(win);
          requestAnimationFrame(() => {
            win.classList.add("open");
            bringToFront(win);
          });
          activeWindows[section] = win;
          win.dataset.minimized = "false";
          const header = win.querySelector(".win-header");
          header.addEventListener("mousedown", (e) => startDrag(e, win));
          header.addEventListener("dblclick", () => toggleMaximize(win));
          win.querySelectorAll(".win-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              const action = btn.dataset.action;
              if (action === "minimize") minimizeWindow(section);
              if (action === "maximize") toggleMaximize(win);
              if (action === "close") closeWindow(section);
              e.stopPropagation();
            });
          });
          const resizer = win.querySelector(".win-resize-handle");
          resizer.addEventListener("mousedown", (e) => startResize(e, win));
          win.addEventListener("mousedown", () => {
            bringToFront(win);
            setDockActive(section);
          });
          const content = win.querySelector(".win-content");
          content.addEventListener("keydown", (ev) => {
            if (ev.key === "Escape") closeWindow(section);
          });
          createDockItem(section);
          setDockActive(section);
          positionDock();
        }

        function bringToFront(win) {
          zCounter++;
          win.style.zIndex = zCounter;
          document
            .querySelectorAll(".app-window")
            .forEach((w) => w.classList.remove("top"));
          win.classList.add("top");
        }
        function minimizeWindow(section) {
          const win = activeWindows[section];
          if (!win) return;
          win.dataset.minimized = "true";
          win.classList.remove("open");
          win.classList.add("closing");
          setTimeout(() => {
            win.style.display = "none";
            win.classList.remove("closing");
          }, 240);
          const item = dock.querySelector(`[data-dock="${section}"]`);
          if (item) {
            item.classList.add("minimized");
            item.classList.remove("active");
          }
          positionDock();
        }
        function restoreFromDock(section) {
          const win = activeWindows[section];
          if (!win) return;
          win.style.display = "block";
          win.dataset.minimized = "false";
          requestAnimationFrame(() => {
            win.classList.add("open");
            bringToFront(win);
            const item = dock.querySelector(`[data-dock="${section}"]`);
            if (item) {
              item.classList.remove("minimized");
              item.classList.add("active");
            }
            clampWindowToViewport(win);
          });
          positionDock();
        }

        function toggleMaximize(win) {
          const isMax = win.classList.contains("maximized");
          if (isMax) {
            win.classList.remove("maximized");
            if (win._restore) {
              requestAnimationFrame(() => {
                win.style.left = win._restore.left;
                win.style.top = win._restore.top;
                win.style.width = win._restore.width;
                win.style.height = win._restore.height;
                setTimeout(() => {
                  delete win._restore;
                  positionDock();
                }, 20);
              });
            }
          } else {
            const rect = win.getBoundingClientRect();
            win._restore = {
              left: rect.left + "px",
              top: rect.top + "px",
              width: rect.width + "px",
              height: rect.height + "px",
            };
            win.style.left = "";
            win.style.top = "";
            win.style.width = "";
            win.style.height = "";
            requestAnimationFrame(() => {
              win.classList.add("maximized");
              positionDock();
            });
          }
          bringToFront(win);
        }

        function closeWindow(section) {
          const win = activeWindows[section];
          if (!win) return;
          win.classList.add("closing");
          win.dataset.minimized = "false";
          setTimeout(() => {
            try {
              windowsRoot.removeChild(win);
            } catch (e) {}
            delete activeWindows[section];
            const item = dock.querySelector(`[data-dock="${section}"]`);
            if (item) dock.removeChild(item);
            positionDock();
          }, 220);
        }

        function createDockItem(section) {
          if (dock.querySelector(`[data-dock="${section}"]`)) return;
          const item = document.createElement("div");
          item.className = "dock-item";
          item.dataset.dock = section;
          item.innerHTML = `<span style="font-size:12px;opacity:.92">${sectionNames[section]}</span>`;
          item.addEventListener("click", () => {
            const win = activeWindows[section];
            if (!win) {
              openWindow(section);
              return;
            }
            if (win.dataset.minimized === "true") restoreFromDock(section);
            else minimizeWindow(section);
          });
          dock.appendChild(item);
          positionDock();
        }

        function setDockActive(section) {
          const items = dock.querySelectorAll(".dock-item");
          items.forEach((it) => it.classList.remove("active"));
          const activeItem = dock.querySelector(`[data-dock="${section}"]`);
          if (activeItem) activeItem.classList.add("active");
        }

        let dragState = null;
        function startDrag(e, win) {
          if (win.classList.contains("maximized")) return;
          dragState = {
            win,
            startX: e.clientX,
            startY: e.clientY,
            origLeft: parseFloat(
              win.style.left || win.getBoundingClientRect().left
            ),
            origTop: parseFloat(
              win.style.top || win.getBoundingClientRect().top
            ),
          };
          document.addEventListener("mousemove", doDrag);
          document.addEventListener("mouseup", endDrag);
        }
        function doDrag(e) {
          if (!dragState) return;
          const dx = e.clientX - dragState.startX;
          const dy = e.clientY - dragState.startY;
          dragState.win.style.left = dragState.origLeft + dx + "px";
          dragState.win.style.top = dragState.origTop + dy + "px";
        }
        function endDrag() {
          document.removeEventListener("mousemove", doDrag);
          document.removeEventListener("mouseup", endDrag);
          dragState = null;
          document
            .querySelectorAll(".app-window")
            .forEach(clampWindowToViewport);
        }

        let resizeState = null;
        function startResize(e, win) {
          if (win.classList.contains("maximized")) return;
          resizeState = {
            win,
            startX: e.clientX,
            startY: e.clientY,
            origW: win.getBoundingClientRect().width,
            origH: win.getBoundingClientRect().height,
            origLeft: parseFloat(
              win.style.left || win.getBoundingClientRect().left
            ),
            origTop: parseFloat(
              win.style.top || win.getBoundingClientRect().top
            ),
          };
          document.addEventListener("mousemove", doResize);
          document.addEventListener("mouseup", endResize);
          e.preventDefault();
          e.stopPropagation();
        }
        function doResize(e) {
          if (!resizeState) return;
          const dx = e.clientX - resizeState.startX;
          const dy = e.clientY - resizeState.startY;
          const newW = Math.max(280, resizeState.origW + dx);
          const newH = Math.max(160, resizeState.origH + dy);
          const win = resizeState.win;
          win.style.width = newW + "px";
          win.style.height = newH + "px";
        }
        function endResize() {
          document.removeEventListener("mousemove", doResize);
          document.removeEventListener("mouseup", endResize);
          resizeState = null;
        }

        function clampWindowToViewport(win) {
          if (!win) return;
          const rect = win.getBoundingClientRect();
          const width = rect.width;
          const height = rect.height;
          let left = parseFloat(win.style.left || rect.left);
          let top = parseFloat(win.style.top || rect.top);
          const maxLeft = window.innerWidth - width - 24;
          const maxTop = window.innerHeight - height - 24;
          if (left > maxLeft) left = Math.max(8, maxLeft);
          if (top > maxTop) top = Math.max(8, maxTop);
          if (left < 8) left = 8;
          if (top < 8) top = 8;
          win.style.left = left + "px";
          win.style.top = top + "px";
        }

        document.querySelectorAll(".desktop-icon").forEach((icon) => {
          icon.addEventListener("click", () => {
            const action = icon.dataset.action || "";
            const match = action.match(/open-?(.*)/);
            const section = match ? match[1] : action;
            if (section) openWindow(section);
          });
        });

        const originalHandleSystemCommand = window.handleSystemCommand;
        window.handleSystemCommand = function (input) {
          if (!input) {
            addTerminalOutput("> ");
            return;
          }
          const parts = input.trim().split(/\s+/);
          const cmd = parts[0].toLowerCase();
          const args = parts.slice(1);
          switch (cmd) {
            case "help":
              addTerminalOutput([
                "> AVAILABLE COMMANDS:",
                "  help      - show this list",
                "  list      - list available desktop sections",
                "  open <x>  - open a section (files, updates, community, about)",
                "  clear     - clear the terminal output",
              ]);
              break;
            case "list":
              addTerminalOutput("> SECTIONS: files, updates, community, about");
              break;
            case "open":
              if (!args.length) {
                addTerminalOutput("> usage: open <section>");
              } else {
                const target = args[0].toLowerCase();
                addTerminalOutput(`> OPENING: ${target.toUpperCase()}`);
                setTimeout(() => openWindow(target), 120);
              }
              break;
            case "clear":
              terminalOutput.innerHTML = "";
              break;
            default:
              addTerminalOutput(`> UNKNOWN COMMAND: ${input}`);
          }
        };

        window.openWindow = openWindow;

        window.addEventListener("resize", () => {
          Object.values(activeWindows).forEach((win) => {
            if (!win) return;
            clampWindowToViewport(win);
          });
          positionDock();
        });

        function positionDock() {
          if (!dock) return;
          dock.style.left = "50%";
          dock.style.transform = "translateX(-50%)";
          let bottomOffset = 12;
          try {
            const termInput = document.getElementById("terminal-input");
            if (termInput) {
              const termContainer = termInput.closest("div.fixed");
              if (termContainer) {
                const rect = termContainer.getBoundingClientRect();
                const dangerZone = window.innerHeight - 120;
                if (rect.top > dangerZone) {
                  const margin = 16;
                  bottomOffset = rect.height + margin;
                } else {
                  bottomOffset = 12;
                }
              }
            }
          } catch (e) {
            bottomOffset = 12;
          }
          dock.style.bottom = bottomOffset + "px";
        }

        try {
          const term = document.getElementById("terminal-input");
          if (term) {
            const termContainer = term.closest("div.fixed");
            if (termContainer && window.ResizeObserver) {
              const ro = new ResizeObserver(() => positionDock());
              ro.observe(termContainer);
            }
          }
        } catch (e) {}
        setTimeout(positionDock, 120);
        window.addEventListener("load", positionDock);

        setInterval(() => {
          const focused = Object.keys(activeWindows).find((k) => {
            const w = activeWindows[k];
            return w && w.classList && w.classList.contains("top");
          });
          if (focused) setDockActive(focused);
        }, 300);

        return { openWindow };
      })();
    </script>

    <!-- System tray clock + calendar behavior (modified to work with window-styled calendar) -->
    <script>
      (function () {
        const clockBtn = document.getElementById("clock-btn");
        const clockTime = document.getElementById("clock-time");
        const clockDate = document.getElementById("clock-date");
        const panel = document.getElementById("calendar-panel"); // now app-window-styled
        const calGrid = document.getElementById("cal-grid");
        const calTitle = document.getElementById("cal-title");
        const calPrev = document.getElementById("cal-prev");
        const calNext = document.getElementById("cal-next");
        const calTodayBtn = document.getElementById("cal-goto-today");
        const notifList = document.getElementById("notif-list");
        const calClose = document.getElementById("cal-close");

        let view = new Date();
        let shownYear = view.getFullYear();
        let shownMonth = view.getMonth();

        function pad(n) {
          return n < 10 ? "0" + n : String(n);
        }
        function updateClock() {
          const now = new Date();
          const hh = pad(now.getHours());
          const mm = pad(now.getMinutes());
          clockTime.textContent = `${hh}:${mm}`;
          const dstr = now.toLocaleDateString(undefined, {
            month: "short",
            day: "numeric",
            year: "numeric",
          });
          clockDate.textContent = dstr;
        }
        updateClock();
        setInterval(updateClock, 1000);

        function openPanel() {
          panel.classList.add("open");
          panel.setAttribute("aria-hidden", "false");
          clockBtn.setAttribute("aria-expanded", "true");
          renderCalendar(shownYear, shownMonth);
          // bring to front visually
          panel.style.zIndex =
            parseInt(
              getComputedStyle(document.documentElement).getPropertyValue(
                "--z"
              ) || 200
            ) + 1;
        }
        function closePanel() {
          panel.classList.remove("open");
          panel.setAttribute("aria-hidden", "true");
          clockBtn.setAttribute("aria-expanded", "false");
        }
        function togglePanel() {
          if (panel.classList.contains("open")) closePanel();
          else openPanel();
        }

        clockBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          togglePanel();
        });

        // close via header close button
        calClose.addEventListener("click", (e) => {
          e.stopPropagation();
          closePanel();
        });

        document.addEventListener("click", (e) => {
          if (!panel.contains(e.target) && !clockBtn.contains(e.target))
            closePanel();
        });
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") closePanel();
        });

        function renderCalendar(year, month) {
          calGrid.innerHTML = "";
          const first = new Date(year, month, 1);
          const last = new Date(year, month + 1, 0);
          const firstWeekday = first.getDay();
          const daysInMonth = last.getDate();
          const prevLast = new Date(year, month, 0);
          const daysInPrev = prevLast.getDate();
          calTitle.textContent = first.toLocaleDateString(undefined, {
            month: "long",
            year: "numeric",
          });
          const totalCells = 42;
          let dayCounter = 1;
          let nextMonthDay = 1;
          for (let i = 0; i < totalCells; i++) {
            const cell = document.createElement("div");
            cell.className = "cal-cell";
            let cellText = "";
            if (i < firstWeekday) {
              const d = daysInPrev - (firstWeekday - 1 - i);
              cellText = d;
              cell.classList.add("other");
            } else if (dayCounter <= daysInMonth) {
              cellText = dayCounter;
              const isToday =
                year === new Date().getFullYear() &&
                month === new Date().getMonth() &&
                dayCounter === new Date().getDate();
              if (isToday) cell.classList.add("today");
              dayCounter++;
            } else {
              cellText = nextMonthDay++;
              cell.classList.add("other");
            }
            cell.textContent = cellText;
            calGrid.appendChild(cell);
          }
          const now = new Date();
          const todayStr = now.toLocaleDateString(undefined, {
            weekday: "long",
            month: "short",
            day: "numeric",
          });
          const calNow = document.getElementById("cal-now");
          if (calNow) calNow.textContent = todayStr;
        }

        calPrev.addEventListener("click", (e) => {
          e.stopPropagation();
          shownMonth--;
          if (shownMonth < 0) {
            shownMonth = 11;
            shownYear--;
          }
          renderCalendar(shownYear, shownMonth);
        });
        calNext.addEventListener("click", (e) => {
          e.stopPropagation();
          shownMonth++;
          if (shownMonth > 11) {
            shownMonth = 0;
            shownYear++;
          }
          renderCalendar(shownYear, shownMonth);
        });
        calTodayBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          const n = new Date();
          shownYear = n.getFullYear();
          shownMonth = n.getMonth();
          renderCalendar(shownYear, shownMonth);
        });

        function initNotifications() {
          notifList.innerHTML = "";
          const p = document.createElement("div");
          p.style.opacity = ".6";
          p.textContent = "No notifications";
          notifList.appendChild(p);
        }
        initNotifications();

        renderCalendar(shownYear, shownMonth);

        function adjustPanelPosition() {
          let bottomOffset = 64;
          try {
            const termInput = document.getElementById("terminal-input");
            if (termInput) {
              const termContainer = termInput.closest("div.fixed");
              if (termContainer) {
                const rect = termContainer.getBoundingClientRect();
                const dangerZone = window.innerHeight - 120;
                if (rect.top > dangerZone) bottomOffset = rect.height + 28;
              }
            }
          } catch (e) {}
          panel.style.bottom = bottomOffset + "px";
        }
        window.addEventListener("resize", adjustPanelPosition);
        setTimeout(adjustPanelPosition, 120);
      })();
    </script>
  
<script>
(function(){
  // Helpers
  function getIconForSection(section){
    return document.querySelector('.desktop-icon[data-action="open-' + section + '"]') ||
           document.querySelector('.desktop-icon[data-action="' + section + '"]') || null;
  }
  function px(n){ return Math.round(n) + 'px'; }

  function animateFromIcon(win, iconEl, finalRect, onComplete){
    if(!iconEl || !iconEl.getBoundingClientRect){
      // fallback simple pop
      win.classList.add('open');
      win.style.transform = 'translateY(0) scale(1)';
      win.style.opacity = '1';
      if(onComplete) setTimeout(onComplete, 300);
      return;
    }
    const iconRect = iconEl.getBoundingClientRect();
    const finalCenterX = finalRect.left + finalRect.width/2;
    const finalCenterY = finalRect.top + finalRect.height/2;
    const iconCenterX = iconRect.left + iconRect.width/2;
    const iconCenterY = iconRect.top + iconRect.height/2;
    const dx = iconCenterX - finalCenterX;
    const dy = iconCenterY - finalCenterY;

    win.style.transition = 'none';
    win.style.transform = 'translate(' + dx + 'px,' + dy + 'px) scale(0.18)';
    win.style.opacity = '0';
    void win.offsetWidth;
    requestAnimationFrame(function(){
      win.classList.add('open');
      win.style.transition = 'transform 420ms cubic-bezier(0.2,0.9,0.2,1), opacity 260ms ease';
      win.style.transform = 'translate(0px, 0px) scale(1)';
      win.style.opacity = '1';
      function onend(e){
        if(e && e.target !== win) return;
        win.removeEventListener('transitionend', onend);
        win.style.transition = '';
        win.style.transform = '';
        if(onComplete) onComplete();
      }
      win.addEventListener('transitionend', onend);
    });
  }

  function animateCloseToIcon(win, iconEl, cleanup){
    if(!win){ if(cleanup) cleanup(); return; }
    const currRect = win.getBoundingClientRect();
    if(!iconEl || !iconEl.getBoundingClientRect){
      win.style.transition = 'transform 260ms ease, opacity 200ms ease';
      win.style.transform = 'translateY(8px) scale(0.96)';
      win.style.opacity = '0';
      win.addEventListener('transitionend', function once(){ win.removeEventListener('transitionend', once); if(cleanup) cleanup(); });
      return;
    }
    const iconRect = iconEl.getBoundingClientRect();
    const currCenterX = currRect.left + currRect.width/2;
    const currCenterY = currRect.top + currRect.height/2;
    const iconCenterX = iconRect.left + iconRect.width/2;
    const iconCenterY = iconRect.top + iconRect.height/2;
    const dx = iconCenterX - currCenterX;
    const dy = iconCenterY - currCenterY;

    win.style.transition = 'transform 420ms cubic-bezier(0.2,0.9,0.2,1), opacity 260ms ease';
    win.style.transform = 'translate(0px,0px) scale(1)';
    void win.offsetWidth;
    requestAnimationFrame(function(){
      win.style.transform = 'translate(' + dx + 'px,' + dy + 'px) scale(0.18)';
      win.style.opacity = '0';
      function onend(e){ if(e && e.target !== win) return; win.removeEventListener('transitionend', onend); if(cleanup) cleanup(); }
      win.addEventListener('transitionend', onend);
    });
  }

  // Override window functions by re-defining them here
  // We'll replace openWindow/minimize/restore/toggleMaximize/closeWindow/createDockItem
  // while keeping other helpers in place (drag/resize/clamp/positionDock remain from original script)

  // store references to DOM nodes used by original system
  const windowsRoot = document.getElementById('windows-root');
  const dock = document.getElementById('window-dock');

  // openWindow replacement
  window.openWindow = function(section){
    section = (section || '').toLowerCase();
    const sectionNames = { files: 'Files', updates: 'Updates', community: 'Community', about: 'About' };
    if(!sectionNames[section]){ if(window.addTerminalOutput) addTerminalOutput('> ERROR: Unknown section "' + section + '"'); return; }
    if(window.activeWindows && window.activeWindows[section]){ const w = window.activeWindows[section]; if(w.dataset.minimized === 'true') window.restoreFromDock(section); else window.bringToFront && window.bringToFront(w); window.setDockActive && window.setDockActive(section); return; }
    // create window element
    const win = document.createElement('div');
    win.className = 'app-window sci-fade';
    win.dataset.window = section;
    const posLeft = Math.max(24, window.innerWidth/2 - 320) + (Math.random()*40 - 20);
    const posTop = Math.max(24, window.innerHeight/2 - 210) + (Math.random()*40 - 20);
    win.style.left = posLeft + 'px';
    win.style.top = posTop + 'px';
    win.style.width = '640px';
    win.style.height = '420px';
    win.innerHTML = '<div class="win-header" role="toolbar" aria-label="' + sectionNames[section] + ' header">' +
                    '<div class="win-title">' + sectionNames[section] + '</div>' +
                    '<div class="win-controls" role="group" aria-label="window controls">' +
                    '<div class="win-btn min" title="Minimize" data-action="minimize">-</div>' +
                    '<div class="win-btn max" title="Maximize" data-action="maximize">□</div>' +
                    '<div class="win-btn close" title="Close" data-action="close">×</div>' +
                    '</div></div>' +
                    '<div class="win-content" tabindex="0"><div class="placeholder-empty"> ' + sectionNames[section] + ' — content area (placeholder)</div></div>' +
                    '<div class="win-resize-handle" aria-hidden="true"></div>';

    windowsRoot.appendChild(win);
    // ensure layout
    const finalRect = win.getBoundingClientRect();

    // maintain activeWindows map on window object for compatibility
    window.activeWindows = window.activeWindows || {};
    window.activeWindows[section] = win;
    win.dataset.minimized = 'false';

    // attach controls; many helpers (startDrag, startResize, toggleMaximize, closeWindow) are expected to exist from the original script
    const header = win.querySelector('.win-header');
    header && header.addEventListener('mousedown', function(e){ if(window.startDrag) window.startDrag(e, win); });
    header && header.addEventListener('dblclick', function(){ if(window.toggleMaximize) window.toggleMaximize(win); });

    win.querySelectorAll('.win-btn').forEach(function(btn){
      btn.addEventListener('click', function(e){
        const action = btn.dataset.action;
        if(action === 'minimize' && window.minimizeWindow) window.minimizeWindow(section);
        if(action === 'maximize' && window.toggleMaximize) window.toggleMaximize(win);
        if(action === 'close' && window.closeWindow) window.closeWindow(section);
        e.stopPropagation();
      });
    });

    const resizer = win.querySelector('.win-resize-handle');
    resizer && resizer.addEventListener('mousedown', function(e){ if(window.startResize) window.startResize(e, win); });

    win.addEventListener('mousedown', function(){ if(window.bringToFront) { window.bringToFront(win); } if(window.setDockActive) window.setDockActive(section); });

    const content = win.querySelector('.win-content');
    content && content.addEventListener('keydown', function(ev){ if(ev.key === 'Escape' && window.closeWindow) window.closeWindow(section); });

    // create dock item (if original createDockItem exists use it, else make simple)
    if(window.createDockItem) window.createDockItem(section);
    else {
      // simple dock item
      const item = document.createElement('div');
      item.className = 'dock-item';
      item.dataset.dock = section;
      item.innerHTML = '<span style="font-size:12px;opacity:.92">' + sectionNames[section] + '</span>';
      item.addEventListener('click', function(){
        const w = window.activeWindows && window.activeWindows[section];
        if(!w) window.openWindow(section);
        else if(w.dataset.minimized === 'true' && window.restoreFromDock) window.restoreFromDock(section);
        else if(window.minimizeWindow) window.minimizeWindow(section);
      });
      dock.appendChild(item);
    }

    // animate from icon
    const icon = getIconForSection(section);
    animateFromIcon(win, icon, finalRect, function(){
      try{ win.style.transition = ''; win.style.transform = ''; win.style.opacity = ''; }catch(e){}
      const ce = win.querySelector('.win-content'); if(ce) ce.focus();
      if(window.clampWindowToViewport) window.clampWindowToViewport(win);
    });
    if(window.positionDock) window.positionDock();
  };

  // closeWindow override that shrinks back to icon
  window.closeWindow = function(section){
    window.activeWindows = window.activeWindows || {};
    const win = window.activeWindows[section];
    if(!win) return;
    win.dataset.minimized = 'false';
    const icon = getIconForSection(section);
    win.style.pointerEvents = 'none';
    animateCloseToIcon(win, icon, function(){
      try{ windowsRoot.removeChild(win); }catch(e){}
      delete window.activeWindows[section];
      // remove dock item if present
      const item = dock && dock.querySelector && dock.querySelector('[data-dock="' + section + '"]');
      if(item && item.parentNode) item.parentNode.removeChild(item);
      if(window.positionDock) window.positionDock();
    });
  };

  // expose utility for other scripts to call (non-destructive)
  window.animateFromIcon = animateFromIcon;
  window.animateCloseToIcon = animateCloseToIcon;

})();
</script>


<script>
(function(){
  function px(n){ return Math.round(n) + 'px'; }
  // Robust maximize/restore that animates sizes and restores exact previous rect
  window.toggleMaximize = function(win){
    if(!win) return;
    if(win.classList.contains('maximized')){
      // restore
      if(!win._restore) {
        win.classList.remove('maximized');
        return;
      }
      const r = win._restore;
      const curr = win.getBoundingClientRect();
      // set current explicit rect to start animation
      win.style.left = curr.left + 'px';
      win.style.top = curr.top + 'px';
      win.style.width = curr.width + 'px';
      win.style.height = curr.height + 'px';
      // force layout
      void win.offsetWidth;
      // animate back to stored restore rect
      requestAnimationFrame(function(){
        win.style.transition = 'left 420ms cubic-bezier(0.2,0.9,0.2,1), top 420ms cubic-bezier(0.2,0.9,0.2,1), width 420ms cubic-bezier(0.2,0.9,0.2,1), height 420ms cubic-bezier(0.2,0.9,0.2,1)';
        win.style.left = r.left;
        win.style.top = r.top;
        win.style.width = r.width;
        win.style.height = r.height;
      });
      const done = function(){
        win.removeEventListener('transitionend', done);
        win.classList.remove('maximized');
        // cleanup
        delete win._restore;
        win.style.transition = '';
        win.style.left = '';
        win.style.top = '';
        win.style.width = '';
        win.style.height = '';
        if(window.positionDock) window.positionDock();
      };
      win.addEventListener('transitionend', done);
      return;
    } else {
      // maximize
      const rect = win.getBoundingClientRect();
      win._restore = { left: rect.left + 'px', top: rect.top + 'px', width: rect.width + 'px', height: rect.height + 'px' };
      // set explicit start rect
      win.style.left = rect.left + 'px';
      win.style.top = rect.top + 'px';
      win.style.width = rect.width + 'px';
      win.style.height = rect.height + 'px';
      void win.offsetWidth;
      requestAnimationFrame(function(){
        const left = 40;
        const top = 40;
        const width = Math.max(300, window.innerWidth - 80);
        const height = Math.max(240, window.innerHeight - 96);
        win.classList.add('maximized');
        win.style.transition = 'left 420ms cubic-bezier(0.2,0.9,0.2,1), top 420ms cubic-bezier(0.2,0.9,0.2,1), width 420ms cubic-bezier(0.2,0.9,0.2,1), height 420ms cubic-bezier(0.2,0.9,0.2,1)';
        win.style.left = px(left);
        win.style.top = px(top);
        win.style.width = px(width);
        win.style.height = px(height);
      });
      const doneMax = function(){
        win.removeEventListener('transitionend', doneMax);
        // leave class maximized, but clear inline sizes so downstream code can operate
        win.style.transition = '';
        win.style.left = '';
        win.style.top = '';
        win.style.width = '';
        win.style.height = '';
        if(window.positionDock) window.positionDock();
      };
      win.addEventListener('transitionend', doneMax);
      return;
    }
  };
})();
</script>

<!-- SFX: paste this block just before </body> -->
<!-- Update the src attributes to point at your actual sound files -->
<audio id="sfx-boot" src="sfx/boot.wav" preload="auto"></audio>
<audio id="sfx-click" src="sfx/click.wav" preload="auto"></audio>
<audio id="sfx-open" src="sfx/open.wav" preload="auto"></audio>
<audio id="sfx-close" src="sfx/close.wav" preload="auto"></audio>
<audio id="sfx-type" src="sfx/type.wav" preload="auto"></audio>

<script>
(function(){
  function playSfx(id, opts = {}) {
    try {
      const base = document.getElementById(id);
      if (!base) return;
      const s = base.cloneNode(true);
      if (opts.volume != null) s.volume = opts.volume;
      if (opts.playbackRate != null) s.playbackRate = opts.playbackRate;
      s.currentTime = 0;
      s.play?.().catch(()=>{});
      s.addEventListener('ended', () => { try{ s.remove(); }catch(e){} });
      document.body.appendChild(s);
      setTimeout(()=>{ try{ s.remove(); }catch(e){} }, 3000);
    } catch (e) {}
  }
  function randomPitch(base = 1, spread = 0.06){ return base + (Math.random() * spread * 2 - spread); }

  // Boot sound (fires when runBootSequence is called, fallback on load)
  try {
    if (typeof runBootSequence === 'function') {
      const _orig = runBootSequence;
      runBootSequence = function(...a){ playSfx('sfx-boot',{volume:0.9}); return _orig.apply(this,a); };
    } else {
      window.addEventListener('load', ()=> setTimeout(()=> playSfx('sfx-boot',{volume:0.9}),200));
    }
  } catch(e){}

  // Desktop icon click
  try {
    document.querySelectorAll('.desktop-icon').forEach(icon => {
      if (!icon.dataset.sfxBound) {
        icon.addEventListener('click', ()=> playSfx('sfx-click',{volume:0.7}));
        icon.dataset.sfxBound = '1';
      }
    });
  } catch(e){}

  // openWindow / closeWindow wrappers
  try {
    if (window.openWindow) {
      const _o = window.openWindow;
      window.openWindow = function(...a){ playSfx('sfx-open',{volume:0.78}); return _o.apply(this,a); };
    }
  } catch(e){}
  try {
    if (window.closeWindow) {
      const _c = window.closeWindow;
      window.closeWindow = function(...a){ playSfx('sfx-close',{volume:0.86, playbackRate:1.02}); return _c.apply(this,a); };
    }
  } catch(e){}
  try {
    if (window.animateCloseToIcon) {
      const _ac = window.animateCloseToIcon;
      window.animateCloseToIcon = function(...a){ playSfx('sfx-close',{volume:0.86, playbackRate:1.02}); return _ac.apply(this,a); };
    }
  } catch(e){}

  // typeLine & addTerminalOutput: non-invasive per-char beeps
  try {
    if (typeof typeLine === 'function') {
      const _t = typeLine;
      typeLine = function(line,...rest){
        try {
          const avg = 32;
          for (let i=0;i<line.length;i++){
            const t = Math.max(12, avg + (Math.random()*18 - 9));
            setTimeout(()=> playSfx('sfx-type',{volume:0.36, playbackRate: randomPitch(1,0.07)}), i * t);
          }
        } catch(e){}
        return _t.apply(this,[line,...rest]);
      };
    }
  } catch(e){}
  try {
    if (typeof addTerminalOutput === 'function') {
      const _a = addTerminalOutput;
      addTerminalOutput = function(msg){
        try {
          const lines = Array.isArray(msg)? msg : [msg];
          let totalChars = lines.reduce((s,l)=> s + String(l).length, 0);
          const avg = 28;
          for (let i=0;i<totalChars;i++){
            const t = Math.max(10, avg + (Math.random()*18 - 9));
            setTimeout(()=> playSfx('sfx-type',{volume:0.34, playbackRate: randomPitch(1,0.06)}), i * t);
          }
        } catch(e){}
        return _a.apply(this, arguments);
      };
    }
  } catch(e){}

  // Terminal input per-char feedback
  try {
    const term = document.getElementById('terminal-input');
    if (term && !term.dataset.sfxTyping) {
      term.addEventListener('keydown', (ev) => {
        const k = ev.key;
        if (!k) return;
        if (k === 'Enter' || k === 'Tab' || k === 'Shift' || k === 'Control' || k === 'Alt' || k === 'Meta') return;
        if (k === 'Backspace' || k === 'Delete') { playSfx('sfx-click',{volume:0.26, playbackRate:0.98}); return; }
        if (k.length === 1) playSfx('sfx-type',{volume:0.26, playbackRate: randomPitch(1,0.09)});
      });
      term.dataset.sfxTyping = '1';
    }
  } catch(e){}

  // window control buttons
  try {
    document.querySelectorAll('.win-btn').forEach(btn => {
      if (!btn.dataset.sfxBound) {
        btn.addEventListener('click', ()=> playSfx('sfx-click',{volume:0.6, playbackRate:0.98}));
        btn.dataset.sfxBound = '1';
      }
    });
  } catch(e){}

})();
</script>

</body>
</html>
